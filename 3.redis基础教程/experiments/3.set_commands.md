# Redis Set 命令测试用例
# 使用方法: redis-cli < 3.set_commands.redis
# 或逐条复制命令到 redis-cli 中执行

# ============================================
# 测试1: SADD - 添加成员到集合
# ============================================

# 添加单个成员
SADD tags:article:1001 "redis"
SADD tags:article:1001 "database"
SADD tags:article:1001 "nosql"

# 添加多个成员（一次添加）
SADD tags:article:1002 "golang" "backend" "web3"

# 添加重复成员（返回0，不添加）
SADD tags:article:1001 "redis"

# 查看集合成员
SMEMBERS tags:article:1001
SMEMBERS tags:article:1002

# ============================================
# 测试2: SMEMBERS - 获取所有成员
# ============================================

# 获取集合所有成员
SMEMBERS tags:article:1001

# 获取不存在的集合
SMEMBERS tags:article:9999

# 添加更多成员后查看
SADD tags:article:1001 "cache" "memory"
SMEMBERS tags:article:1001

# ============================================
# 测试3: SREM - 删除集合成员
# ============================================

# 删除单个成员
SREM tags:article:1001 "cache"
SMEMBERS tags:article:1001

# 删除多个成员
SREM tags:article:1001 "memory" "nosql"
SMEMBERS tags:article:1001

# 删除不存在的成员（返回0，不影响）
SREM tags:article:1001 "nonexistent"
SMEMBERS tags:article:1001

# 删除所有成员后，集合自动删除
SREM tags:article:1001 "redis" "database"
SMEMBERS tags:article:1001

# ============================================
# 测试4: SISMEMBER - 判断成员是否存在
# ============================================

# 重新创建测试集合
SADD tags:article:1001 "redis" "database" "nosql" "cache"

# 检查存在的成员
SISMEMBER tags:article:1001 "redis"
SISMEMBER tags:article:1001 "database"

# 检查不存在的成员
SISMEMBER tags:article:1001 "python"
SISMEMBER tags:article:1001 "golang"

# 检查不存在的集合
SISMEMBER tags:article:9999 "redis"

# ============================================
# 测试5: SINTER - 集合交集运算
# ============================================

# 创建多个集合
SADD user:1001:follows "user:1002" "user:1003" "user:1004" "user:1005"
SADD user:1002:follows "user:1001" "user:1003" "user:1004" "user:1006"
SADD user:1003:follows "user:1001" "user:1002" "user:1004" "user:1007"

# 计算两个集合的交集（共同关注）
SINTER user:1001:follows user:1002:follows

# 计算三个集合的交集
SINTER user:1001:follows user:1002:follows user:1003:follows

# 计算不存在的集合的交集
SINTER user:1001:follows user:9999:follows

# 计算没有交集的集合
SADD set1 "a" "b" "c"
SADD set2 "d" "e" "f"
SINTER set1 set2

# ============================================
# 测试6: SUNION - 集合并集运算
# ============================================

# 计算两个集合的并集（所有关注的人）
SUNION user:1001:follows user:1002:follows

# 计算三个集合的并集
SUNION user:1001:follows user:1002:follows user:1003:follows

# 计算不存在的集合的并集
SUNION user:1001:follows user:9999:follows

# 计算有重叠的集合的并集（自动去重）
SADD set3 "a" "b" "c"
SADD set4 "c" "d" "e"
SUNION set3 set4

# ============================================
# 测试7: SDIFF - 集合差集运算
# ============================================

# 计算第一个集合相对于第二个集合的差集（user:1001关注但user:1002未关注的人）
SDIFF user:1001:follows user:1002:follows

# 计算第二个集合相对于第一个集合的差集（user:1002关注但user:1001未关注的人）
SDIFF user:1002:follows user:1001:follows

# 计算多个集合的差集（第一个集合相对于其他所有集合的差集）
SDIFF user:1001:follows user:1002:follows user:1003:follows

# 计算不存在的集合的差集
SDIFF user:1001:follows user:9999:follows

# ============================================
# 测试8: SCARD - 获取集合成员数量
# ============================================

# 获取集合成员数量
SCARD user:1001:follows
SCARD user:1002:follows
SCARD tags:article:1001

# 获取不存在的集合的成员数量
SCARD user:9999:follows

# 添加成员后查看数量变化
SADD user:1001:follows "user:1008"
SCARD user:1001:follows

# ============================================
# 测试9: SRANDMEMBER - 随机获取成员
# ============================================

# 随机获取一个成员（不删除）
SRANDMEMBER user:1001:follows
SRANDMEMBER user:1001:follows
SMEMBERS user:1001:follows

# 随机获取多个成员（正数：不重复）
SRANDMEMBER user:1001:follows 3

# 随机获取多个成员（负数：可能重复）
SRANDMEMBER user:1001:follows -3

# ============================================
# 测试10: SPOP - 随机弹出成员（删除）
# ============================================

# 随机弹出一个成员（删除）
SPOP user:1001:follows
SMEMBERS user:1001:follows

# 随机弹出多个成员
SPOP user:1001:follows 2
SMEMBERS user:1001:follows

# 从空集合弹出（返回空）
SPOP user:9999:follows

# ============================================
# 测试11: SMOVE - 移动成员到另一个集合
# ============================================

# 创建源集合和目标集合
SADD source:set "a" "b" "c" "d"
SADD target:set "x" "y"

# 移动成员（成功）
SMOVE source:set target:set "a"
SMEMBERS source:set
SMEMBERS target:set

# 移动不存在的成员（返回0）
SMOVE source:set target:set "z"

# 移动成员到不存在的目标集合（自动创建）
SMOVE source:set new:set "b"
SMEMBERS new:set

# ============================================
# 测试12: WebSocket用户在线状态管理（项目场景）
# ============================================

# 用户上线，添加客户端ID到在线用户集合（参考 websocketcontext.go:241）
SADD websocket:online:users "client:1001"
SADD websocket:online:users "client:1002"
SADD websocket:online:users "client:1003"

# 查看所有在线用户
SMEMBERS websocket:online:users
SCARD websocket:online:users

# 用户下线，移除客户端ID（参考 websocketcontext.go:267）
SREM websocket:online:users "client:1002"
SMEMBERS websocket:online:users

# 检查用户是否在线
SISMEMBER websocket:online:users "client:1001"
SISMEMBER websocket:online:users "client:1002"

# ============================================
# 测试13: 标签系统实现
# ============================================

# 为文章添加标签
SADD article:1001:tags "tech" "golang" "redis" "backend"
SADD article:1002:tags "tech" "python" "redis" "frontend"
SADD article:1003:tags "design" "ui" "frontend"

# 获取文章的所有标签
SMEMBERS article:1001:tags
SMEMBERS article:1002:tags

# 查找包含特定标签的所有文章（需要配合其他数据结构，这里演示标签查询）
SISMEMBER article:1001:tags "redis"
SISMEMBER article:1002:tags "redis"

# 查找两篇文章的共同标签
SINTER article:1001:tags article:1002:tags

# 查找所有不重复的标签（所有文章的标签并集）
SUNION article:1001:tags article:1002:tags article:1003:tags

# ============================================
# 测试14: 共同关注功能实现（使用SINTER）
# ============================================

# 用户A的关注列表
SADD user:A:follows "user:1" "user:2" "user:3" "user:4" "user:5"

# 用户B的关注列表
SADD user:B:follows "user:2" "user:3" "user:6" "user:7"

# 用户C的关注列表
SADD user:C:follows "user:1" "user:3" "user:5" "user:8"

# 查找A和B的共同关注
SINTER user:A:follows user:B:follows

# 查找A、B、C三人的共同关注
SINTER user:A:follows user:B:follows user:C:follows

# 查找A关注但B未关注的人（推荐关注）
SDIFF user:A:follows user:B:follows

# ============================================
# 测试15: 黑名单/白名单系统
# ============================================

# 创建黑名单
SADD blacklist:ip "192.168.1.100" "192.168.1.101" "10.0.0.50"

# 检查IP是否在黑名单中
SISMEMBER blacklist:ip "192.168.1.100"
SISMEMBER blacklist:ip "192.168.1.200"

# 移除黑名单IP
SREM blacklist:ip "192.168.1.101"
SMEMBERS blacklist:ip

# 创建白名单
SADD whitelist:users "user:1001" "user:1002" "user:1003"

# 检查用户是否在白名单中
SISMEMBER whitelist:users "user:1001"
SISMEMBER whitelist:users "user:9999"

# ============================================
# 测试16: 抽奖系统（使用SRANDMEMBER/SPOP）
# ============================================

# 创建参与者集合
SADD lottery:participants "user:1001" "user:1002" "user:1003" "user:1004" "user:1005"

# 随机抽取3个中奖者（不删除，可以重复抽）
SRANDMEMBER lottery:participants 3

# 随机抽取3个中奖者（删除，确保不重复）
SPOP lottery:participants 3
SMEMBERS lottery:participants

# 查看剩余参与者
SCARD lottery:participants

# ============================================
# 测试17: 商品分类系统
# ============================================

# 商品属于多个分类
SADD product:1001:categories "Electronics" "Computers" "Laptops"
SADD product:1002:categories "Electronics" "Phones" "Smartphones"
SADD product:1003:categories "Clothing" "Men" "Shirts"

# 查找同时属于多个分类的商品（需要配合其他数据结构）
# 这里演示查找商品的分类
SMEMBERS product:1001:categories

# 查找Electronics分类下的所有商品（需要反向索引，这里演示分类操作）
SADD category:Electronics:products "product:1001" "product:1002"
SMEMBERS category:Electronics:products

# ============================================
# 测试18: 集合运算的存储结果（SINTERSTORE/SUNIONSTORE/SDIFFSTORE）
# ============================================

# 创建测试集合
SADD setA "a" "b" "c" "d"
SADD setB "c" "d" "e" "f"

# 将交集结果存储到新集合
SINTERSTORE setA_inter_setB setA setB
SMEMBERS setA_inter_setB

# 将并集结果存储到新集合
SUNIONSTORE setA_union_setB setA setB
SMEMBERS setA_union_setB

# 将差集结果存储到新集合
SDIFFSTORE setA_diff_setB setA setB
SMEMBERS setA_diff_setB

# 存储到已存在的集合（会覆盖）
SINTERSTORE setA_inter_setB setA setB
SMEMBERS setA_inter_setB

# ============================================
# 测试19: 用户权限系统
# ============================================

# 用户拥有的权限
SADD user:1001:permissions "read" "write" "delete" "admin"
SADD user:1002:permissions "read" "write"
SADD user:1003:permissions "read"

# 检查用户是否有特定权限
SISMEMBER user:1001:permissions "admin"
SISMEMBER user:1002:permissions "admin"

# 查找所有用户的共同权限
SINTER user:1001:permissions user:1002:permissions user:1003:permissions

# 添加权限
SADD user:1002:permissions "delete"
SMEMBERS user:1002:permissions

# 移除权限
SREM user:1001:permissions "delete"
SMEMBERS user:1001:permissions

# ============================================
# 测试20: 集合过期时间管理
# ============================================

# 创建临时集合
SADD temp:session:abc123 "data1" "data2" "data3"

# 设置集合过期时间（60秒）
EXPIRE temp:session:abc123 60
TTL temp:session:abc123

# 查看集合内容
SMEMBERS temp:session:abc123

# 检查过期时间
TTL temp:session:abc123

# ============================================
# 清理测试数据（可选）
# ============================================

# DEL tags:article:1001 tags:article:1002 user:1001:follows user:1002:follows user:1003:follows set1 set2 set3 set4 source:set target:set new:set websocket:online:users article:1001:tags article:1002:tags article:1003:tags user:A:follows user:B:follows user:C:follows blacklist:ip whitelist:users lottery:participants product:1001:categories product:1002:categories product:1003:categories category:Electronics:products setA setB setA_inter_setB setA_union_setB setA_diff_setB user:1001:permissions user:1002:permissions user:1003:permissions temp:session:abc123
