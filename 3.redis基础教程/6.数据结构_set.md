录制：redis基础9_set集合数据结构基础用法.mp4
日期：2026-01-30 22:40:17
录制文件：https://meeting.tencent.com/crm/lvdEGY9Pb9


## 第二阶段：进阶数据结构（2-3周）

### 2.1 Set类型 - 集合操作

**学习目标**: 掌握Set类型，理解集合运算

**学习内容**:

- SADD/SREM：添加/删除成员
- SMEMBERS：获取所有成员
- SISMEMBER：判断成员是否存在
- SINTER/SUNION/SDIFF：集合运算

**项目对应代码**:

- `apps/websocket/internal/svc/websocketcontext.go:241` - SADD（用户客户端关联）
- `apps/websocket/internal/svc/websocketcontext.go:267` - SREM（移除客户端）

**实践任务**:

1. 实现用户在线状态管理（参考websocketcontext.go）
2. 实现标签系统（用Set存储标签）
3. 实现共同关注功能（使用SINTER）


Q1: 直观上手

Q2：set底层数据结构

Redis Set 的底层使用三种编码方式，根据元素类型和数量自动选择：

1. **INTSET（整数集合）** - 小整数集合
   - 条件：所有元素都是整数 且 元素数量 <= 512（set_max_intset_entries）
   - 结构：连续内存，有序存储整数
   - 特点：节省内存，查找使用二分查找 O(log n)

2. **LISTPACK（列表包）** - 小字符串集合
   - 条件：元素不是整数 且 元素数量 <= 128（set_max_listpack_entries）
   - 结构：连续内存，紧凑存储
   - 特点：内存效率高，适合小集合

3. **HASHTABLE（哈希表）** - 大集合
   - 条件：元素数量超过上述限制 或 包含非整数元素
   - 结构：使用 dict（字典），通过哈希函数定位元素
   - 特点：查找快速 O(1)，适合大集合

**自动转换**：当 Set 变大或添加非整数元素时，自动从 INTSET/LISTPACK 转换为 HASHTABLE
