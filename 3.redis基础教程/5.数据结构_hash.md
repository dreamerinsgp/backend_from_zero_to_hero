
录制：redis基础5_hash数据结构基本用法.mp4
日期：2026-01-30 22:20:21
录制文件：https://meeting.tencent.com/crm/2qxzaew56c


### 1.3 Hash类型 - 存储对象

**学习目标**: 掌握Hash类型，理解何时使用Hash vs String

**为什么叫 Hash？**

Redis Hash 类型之所以称为"Hash"，是因为它的底层实现使用了**哈希表（Hash Table）**数据结构：

1. **数据结构层面**：内部使用哈希表存储 field-value 对，通过哈希函数快速定位字段
2. **命名来源**：类似于编程语言中的 `HashMap`、`dict`、`map` 等数据结构
3. **核心特性**：通过哈希函数实现 O(1) 平均时间复杂度的快速查找

**简单理解**：
- Hash = 哈希表 = 键值对映射表
- 就像字典的索引，通过"哈希值"快速找到对应的"值"
- `HSET user:1001 name "Alice"` 就是在哈希表中存储 `name -> "Alice"` 的映射关系

**学习内容**:

- HSET/HGET：设置和获取字段
- HGETALL：获取所有字段
- HDEL：删除字段
- HKEYS/HVALS：获取所有键或值

**项目对应代码**:

- `apps/websocket/internal/svc/redischannel.go:60` - HSET（订阅管理）
- `apps/websocket/internal/svc/redischannel.go:239` - HGETALL（获取所有订阅）
- `apps/websocket/internal/svc/redischannel.go:249` - HDEL（取消订阅）

**实践任务**:

1. 用Hash存储用户信息（对比用String存储JSON的优劣）
2. 实现WebSocket订阅管理（参考redischannel.go）
3. 理解Hash适合存储对象的场景



Q1: hash的底层原理
1) Redis Hash 的底层数据结构
核心要点:
Redis Hash 的底层使用两种编码方式：
1. ZIPLIST（压缩列表）- 小 Hash
   - 条件：字段数 < 512 且 所有值 < 64 字节
   - 结构：连续内存，field 和 value 交替存储
   - 特点：节省内存，但查找需要遍历 O(n)

2. HASHTABLE（哈希表） - 大 Hash
   - 条件：字段数 >= 512 或 任意值 >= 64 字节
   - 结构：使用 dict（字典），通过哈希函数定位 field
   - 特点：查找快速 O(1)，但内存占用稍大

两层存储结构：
- 第一层：Redis 数据库的哈希表（key → Hash对象）
- 第二层：Hash 对象内部的存储（field → value）

自动转换： 当 Hash 变大时，自动从 ZIPLIST 转换为 HASHTABLE

