
### 3. æ€ä¹ˆåˆ†åŒºï¼Ÿ

#### **åˆ†åŒºç­–ç•¥ï¼ˆPartitioning Strategyï¼‰**

Kafka æä¾›äº†å¤šç§åˆ†åŒºç­–ç•¥ï¼Œå†³å®šæ¶ˆæ¯å¦‚ä½•è·¯ç”±åˆ°ä¸åŒçš„ Partitionã€‚

---

#### **ç­–ç•¥ 1ï¼šHash åˆ†åŒºï¼ˆHashPartitionerï¼‰** - æœ€å¸¸ç”¨

**å·¥ä½œåŸç†**ï¼š
```
partition = hash(key) % partitionCount
```

**ç¤ºä¾‹**ï¼š
```go
// é¡¹ç›®ä¸­çš„å®é™…ä½¿ç”¨
config.Producer.Partitioner = sarama.NewHashPartitioner

message := &sarama.ProducerMessage{
    Topic: "sol-trades",
    Key:   sarama.StringEncoder("slot-123"),  // â† Key ç”¨äºåˆ†åŒº
    Value: sarama.ByteEncoder(data),
}

// åˆ†åŒºè®¡ç®—ï¼š
// hash("slot-123") % 3 = 1 â†’ Partition 1
```

**ç‰¹ç‚¹**ï¼š
- âœ… **ç›¸åŒ Key â†’ ç›¸åŒ Partition**ï¼šä¿è¯ç›¸åŒ Key çš„æ¶ˆæ¯æœ‰åº
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šKey åˆ†å¸ƒå‡åŒ€æ—¶ï¼ŒPartition è´Ÿè½½å‡è¡¡
- âœ… **å¯é¢„æµ‹æ€§**ï¼šç›¸åŒ Key æ€»æ˜¯è·¯ç”±åˆ°ç›¸åŒ Partition

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦ä¿è¯ç›¸åŒ Key çš„æ¶ˆæ¯æœ‰åº
- âœ… Key åˆ†å¸ƒç›¸å¯¹å‡åŒ€
- âœ… å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯

---

#### **ç­–ç•¥ 2ï¼šè½®è¯¢åˆ†åŒºï¼ˆRoundRobinPartitionerï¼‰**

**å·¥ä½œåŸç†**ï¼š
```
æ¶ˆæ¯ 1 â†’ Partition 0
æ¶ˆæ¯ 2 â†’ Partition 1
æ¶ˆæ¯ 3 â†’ Partition 2
æ¶ˆæ¯ 4 â†’ Partition 0  â† è½®è¯¢
æ¶ˆæ¯ 5 â†’ Partition 1
...
```

**ç¤ºä¾‹**ï¼š
```go
config.Producer.Partitioner = sarama.NewRoundRobinPartitioner

// ä¸æŒ‡å®š Keyï¼Œæˆ– Key ä¸º nil
message := &sarama.ProducerMessage{
    Topic: "sol-trades",
    Key:   nil,  // â† æ—  Key
    Value: sarama.ByteEncoder(data),
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… **å‡åŒ€åˆ†å¸ƒ**ï¼šæ¶ˆæ¯å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰ Partition
- âœ… **ç®€å•é«˜æ•ˆ**ï¼šä¸éœ€è¦è®¡ç®— Hash
- âŒ **æ— åºæ€§**ï¼šæ— æ³•ä¿è¯æ¶ˆæ¯é¡ºåº

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ä¸éœ€è¦ä¿è¯æ¶ˆæ¯é¡ºåº
- âœ… è¿½æ±‚æœ€å¤§ååé‡
- âœ… Key ä¸é‡è¦æˆ–ä¸å­˜åœ¨

---

#### **ç­–ç•¥ 3ï¼šéšæœºåˆ†åŒºï¼ˆRandomPartitionerï¼‰**

**å·¥ä½œåŸç†**ï¼š
```
éšæœºé€‰æ‹©ä¸€ä¸ª Partition
```

**ç‰¹ç‚¹**ï¼š
- âœ… **ç®€å•**ï¼šéšæœºé€‰æ‹©
- âŒ **æ— åºæ€§**ï¼šå®Œå…¨æ— åº
- âŒ **è´Ÿè½½ä¸å‡**ï¼šå¯èƒ½é€ æˆè´Ÿè½½ä¸å‡è¡¡

**ä½¿ç”¨è¾ƒå°‘**ï¼šä¸€èˆ¬ä¸æ¨èä½¿ç”¨

---

#### **ç­–ç•¥ 4ï¼šè‡ªå®šä¹‰åˆ†åŒºï¼ˆCustomPartitionerï¼‰**

**å·¥ä½œåŸç†**ï¼š
```
å®ç° Partitioner æ¥å£ï¼Œè‡ªå®šä¹‰åˆ†åŒºé€»è¾‘
```

**ç¤ºä¾‹**ï¼š
```go
type CustomPartitioner struct{}

func (p *CustomPartitioner) Partition(message *sarama.ProducerMessage, numPartitions int32) (int32, error) {
    // è‡ªå®šä¹‰åˆ†åŒºé€»è¾‘
    key := string(message.Key.(sarama.StringEncoder))
    
    // ä¾‹å¦‚ï¼šæ ¹æ®ä¸šåŠ¡è§„åˆ™åˆ†åŒº
    if strings.HasPrefix(key, "SOL") {
        return 0, nil  // SOL ç›¸å…³æ¶ˆæ¯ â†’ Partition 0
    } else if strings.HasPrefix(key, "ETH") {
        return 1, nil  // ETH ç›¸å…³æ¶ˆæ¯ â†’ Partition 1
    }
    return 2, nil  // å…¶ä»– â†’ Partition 2
}

config.Producer.Partitioner = &CustomPartitioner{}
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦ç‰¹æ®Šçš„ä¸šåŠ¡åˆ†åŒºè§„åˆ™
- âœ… éœ€è¦å°†ç‰¹å®šç±»å‹çš„æ¶ˆæ¯é›†ä¸­åˆ°ç‰¹å®š Partition
- âœ… å¤æ‚çš„è·¯ç”±éœ€æ±‚

---

#### **ç­–ç•¥ 5ï¼šæŒ‡å®š Partitionï¼ˆManualPartitionï¼‰**

**å·¥ä½œåŸç†**ï¼š
```
ç›´æ¥æŒ‡å®š Partition ç¼–å·
```

**ç¤ºä¾‹**ï¼š
```go
message := &sarama.ProducerMessage{
    Topic:     "sol-trades",
    Partition: 1,  // â† ç›´æ¥æŒ‡å®š Partition 1
    Key:       sarama.StringEncoder("slot-123"),
    Value:     sarama.ByteEncoder(data),
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… **å®Œå…¨æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶æ¶ˆæ¯è·¯ç”±
- âŒ **çµæ´»æ€§å·®**ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†
- âŒ **è´Ÿè½½ä¸å‡**ï¼šå®¹æ˜“é€ æˆè´Ÿè½½ä¸å‡è¡¡

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ç‰¹æ®Šéœ€æ±‚ï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶æ¶ˆæ¯ä½ç½®
- âœ… æµ‹è¯•åœºæ™¯ï¼šæµ‹è¯•ç‰¹å®š Partition

---

### 4. åˆ†åŒºæ•°é‡é€‰æ‹©

#### **å¦‚ä½•ç¡®å®š Partition æ•°é‡ï¼Ÿ**

#### **è€ƒè™‘å› ç´ **

| å› ç´  | è¯´æ˜ | å½±å“ |
|------|------|------|
| **ååé‡éœ€æ±‚** | éœ€è¦å¤„ç†çš„æ¶ˆæ¯é‡ | ååé‡è¶Šå¤§ï¼ŒPartition è¶Šå¤š |
| **Consumer æ•°é‡** | å¹¶è¡Œæ¶ˆè´¹çš„ Consumer æ•°é‡ | Consumer æ•°é‡ â‰¤ Partition æ•°é‡ |
| **æ¶ˆæ¯é¡ºåºè¦æ±‚** | æ˜¯å¦éœ€è¦ä¿è¯é¡ºåº | éœ€è¦é¡ºåº â†’ å‡å°‘ Partition |
| **å­˜å‚¨å®¹é‡** | å•ä¸ª Partition çš„å­˜å‚¨é™åˆ¶ | å•ä¸ª Partition ä¸å®œè¿‡å¤§ |
| **æ‰©å±•æ€§** | æœªæ¥å¢é•¿éœ€æ±‚ | é¢„ç•™æ‰©å±•ç©ºé—´ |

#### **ç»éªŒæ³•åˆ™**

```
Partition æ•°é‡ = max(
    ååé‡éœ€æ±‚ / å•ä¸ª Partition ååé‡,
    Consumer æ•°é‡,
    æœ€å° Partition æ•°é‡ï¼ˆå¦‚ 3ï¼‰
)
```

**ç¤ºä¾‹**ï¼š
```
éœ€æ±‚ï¼š
  - ååé‡ï¼š100,000 msg/s
  - å•ä¸ª Partitionï¼š10,000 msg/s
  - Consumer æ•°é‡ï¼š5

è®¡ç®—ï¼š
  Partition æ•°é‡ = max(100,000 / 10,000, 5, 3) = max(10, 5, 3) = 10

å»ºè®®ï¼š10 ä¸ª Partition
```

#### **æœ€ä½³å®è·µ**

1. âœ… **åˆå§‹è®¾ç½®**ï¼šä» 3-6 ä¸ª Partition å¼€å§‹
2. âœ… **é€æ­¥å¢åŠ **ï¼šæ ¹æ®å®é™…éœ€æ±‚é€æ­¥å¢åŠ 
3. âœ… **é¿å…è¿‡å¤š**ï¼šPartition è¿‡å¤šä¼šå¢åŠ ç®¡ç†å¼€é”€
4. âœ… **è€ƒè™‘ Consumer**ï¼šPartition æ•°é‡ â‰¥ Consumer æ•°é‡
5. âœ… **é¢„ç•™ç©ºé—´**ï¼šé¢„ç•™ 20-30% çš„æ‰©å±•ç©ºé—´

---

### 5. é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨

#### **é¡¹ç›®é…ç½®**

```go
// apps/market/internal/mqs/producer/producer.go
config := sarama.NewConfig()
config.Producer.Partitioner = sarama.NewHashPartitioner  // â† Hash åˆ†åŒº

// å‘é€æ¶ˆæ¯
_kfakaClient.Input() <- &sarama.ProducerMessage{
    Topic: "sol-trades",
    Key:   sarama.StringEncoder("slot-123"),  // â† ä½¿ç”¨ slot ä½œä¸º Key
    Value: sarama.ByteEncoder(tradeData),
}
```

#### **åˆ†åŒºé€»è¾‘**

```
1. ä½¿ç”¨ slot ä½œä¸º Key
2. Hash(slot) % 3 â†’ é€‰æ‹© Partition
3. ç›¸åŒ slot çš„äº¤æ˜“ â†’ åŒä¸€ Partition â†’ ä¿è¯é¡ºåº
```

#### **ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

- âœ… **ä¿è¯é¡ºåº**ï¼šç›¸åŒ slot çš„äº¤æ˜“æœ‰åºå¤„ç†
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šslot åˆ†å¸ƒç›¸å¯¹å‡åŒ€
- âœ… **ç®€å•é«˜æ•ˆ**ï¼šHash åˆ†åŒºå®ç°ç®€å•ï¼Œæ€§èƒ½å¥½

---

### 6. å®é™…æ¡ˆä¾‹ï¼š`apps/consumer` é¡¹ç›®ä¸­çš„åˆ†åŒºå®ç°

#### **é¡¹ç›®èƒŒæ™¯**

`apps/consumer` æ˜¯ä¸€ä¸ª Solana é“¾ä¸Šäº¤æ˜“æ•°æ®æ¶ˆè´¹æœåŠ¡ï¼Œè´Ÿè´£ï¼š
- ç›‘å¬ Solana é“¾ä¸Šçš„äº¤æ˜“æ•°æ®
- å¤„ç†äº¤æ˜“å¹¶å‘é€åˆ° Kafka Topic
- ä½¿ç”¨ Hash åˆ†åŒºç­–ç•¥ç¡®ä¿ç›¸åŒ slot çš„äº¤æ˜“æœ‰åºå¤„ç†

---

#### **6.1 Producer é…ç½®**

**æ–‡ä»¶ä½ç½®**ï¼š`apps/consumer/internal/logic/mq/producer.go`

**å…³é”®é…ç½®ä»£ç **ï¼š

```go
func newAccessLogProducer(brokers []string, _, username, password string) (sarama.SyncProducer, error) {
    config := sarama.NewConfig()
    
    // ... å…¶ä»–é…ç½® ...
    
    // å…³é”®é…ç½®ï¼šä½¿ç”¨ Hash åˆ†åŒºå™¨
    config.Producer.Partitioner = sarama.NewHashPartitioner  // â† Hash åˆ†åŒºç­–ç•¥
    
    // å…è®¸è‡ªåŠ¨åˆ›å»º Topic
    config.Metadata.AllowAutoTopicCreation = true
    
    // ... å…¶ä»–é…ç½®ï¼ˆTLSã€SASL ç­‰ï¼‰...
    
    producer, err := sarama.NewSyncProducer(brokers, config)
    return producer, nil
}
```

**é…ç½®è¯´æ˜**ï¼š
- âœ… **åˆ†åŒºç­–ç•¥**ï¼š`sarama.NewHashPartitioner` - ä½¿ç”¨ Hash åˆ†åŒº
- âœ… **è‡ªåŠ¨åˆ›å»º Topic**ï¼š`AllowAutoTopicCreation = true`
- âœ… **åŒæ­¥ Producer**ï¼šä½¿ç”¨ `SyncProducer` ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸ

---

#### **6.2 æ¶ˆæ¯å‘é€å®ç°**

**æ–‡ä»¶ä½ç½®**ï¼š`apps/consumer/internal/logic/mq/producer.go`

**å‘é€æ¶ˆæ¯å‡½æ•°**ï¼š

```go
func SendEventLogKafkaInfoMessage(topic string, key string, data []byte) error {
    if _kafkaClient == nil {
        return errors.New("_kafkaClient is Nil")
    }

    message := &sarama.ProducerMessage{
        Topic: topic,
        Key:   &accessLogEntry{encoded: []byte(key)},  // â† Key ç”¨äºåˆ†åŒºè·¯ç”±
        Value: &accessLogEntry{encoded: data},
    }

    // åŒæ­¥å‘é€ï¼Œè¿”å› partition å’Œ offset
    p, o, err := _kafkaClient.SendMessage(message)
    if err != nil {
        logx.Errorf("[kafka] send event log to kafka failed: error:%v", err)
        return err
    }
    
    // è®°å½•å‘é€æˆåŠŸä¿¡æ¯ï¼ˆåŒ…å« partition å’Œ offsetï¼‰
    logx.Infof("[kafka] send event log to kafka success: %v:%v:%v, %v, len(data): %v",
        topic, p, o, key, len(data))
    return nil
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… **Key å‚æ•°**ï¼šä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥ï¼Œç”¨äºåˆ†åŒºè·¯ç”±
- âœ… **åŒæ­¥å‘é€**ï¼šä½¿ç”¨ `SendMessage` åŒæ­¥å‘é€ï¼Œç¡®ä¿æ¶ˆæ¯æˆåŠŸ
- âœ… **æ—¥å¿—è®°å½•**ï¼šè®°å½• Topicã€Partitionã€Offsetã€Key ç­‰ä¿¡æ¯

---

#### **6.3 å®é™…ä¸šåŠ¡è°ƒç”¨**

**æ–‡ä»¶ä½ç½®**ï¼š`apps/consumer/internal/logic/sol/block/send.go`

**åœºæ™¯ 1ï¼šå‘é€äº¤æ˜“æ•°æ®åˆ° `sol-trades` Topic**

```go
func (s *BlockService) SendTx(_ context.Context, slot int64, trades []*types.TradeWithPair) {
    // 1. è¿‡æ»¤å’ŒéªŒè¯äº¤æ˜“æ•°æ®
    trades = slice.Filter[*types.TradeWithPair](trades, func(index int, item *types.TradeWithPair) bool {
        if item == nil {
            return false
        }
        if item.Type != types.TradeTypeBuy && item.Type != types.TradeTypeSell {
            return false
        }
        if item.TokenPriceUSD == 0 {
            return false
        }
        item.CreateTime = time.Now()
        return true
    })

    // 2. åºåˆ—åŒ–äº¤æ˜“æ•°æ®
    SolTradeTopic := s.sc.Config.KqSolTrades.Topic  // ä»é…ç½®è¯»å– Topic åç§°
    tradeListJsons, err := json.Marshal(trades)
    if err != nil {
        logx.Errorf("json.Marshal err:%v", err)
        return
    }
    
    // 3. å‘é€åˆ° Kafkaï¼Œä½¿ç”¨ slot ä½œä¸º Key
    err = mq.SendEventLogKafkaInfoMessage(
        SolTradeTopic,                    // Topic: "sol-trades"
        fmt.Sprintf("%v", slot),          // Key: slot ç¼–å·ï¼ˆå¦‚ "310870231"ï¼‰
        tradeListJsons,                   // Value: äº¤æ˜“æ•°æ® JSON
    )
    if err != nil {
        logx.Errorf("SendEventLogKafkaInfoMessage err:%v", err)
        return
    }
}
```

**åˆ†åŒºè·¯ç”±è¿‡ç¨‹**ï¼š

```
1. è¾“å…¥ï¼š
   - Topic: "sol-trades"
   - Key: "310870231" (slot ç¼–å·)
   - Value: [äº¤æ˜“æ•°æ® JSON]

2. Hash åˆ†åŒºè®¡ç®—ï¼š
   partition = hash("310870231") % partitionCount
   
   å‡è®¾ sol-trades Topic æœ‰ 3 ä¸ª Partitionï¼š
   hash("310870231") % 3 = 1 â†’ Partition 1

3. ç»“æœï¼š
   - æ¶ˆæ¯å‘é€åˆ° Partition 1
   - ç›¸åŒ slot çš„æ‰€æœ‰äº¤æ˜“éƒ½ä¼šè·¯ç”±åˆ°åŒä¸€ä¸ª Partition
   - ä¿è¯ç›¸åŒ slot çš„äº¤æ˜“æœ‰åºå¤„ç†
```

**åœºæ™¯ 2ï¼šå‘é€ä»·æ ¼å˜åŒ–åˆ° `sol-pair-price-change` Topic**

```go
func (s *BlockService) SendPairPriceChange2Kafka(_ context.Context, slot int64, pairAddress string) {
    // ä½¿ç”¨ slot ä½œä¸º Keyï¼ŒpairAddress ä½œä¸º Value
    err := mq.SendEventLogKafkaInfoMessage(
        "sol-pair-price-change",         // Topic
        fmt.Sprintf("%v", slot),          // Key: slot ç¼–å·
        []byte(pairAddress),              // Value: äº¤æ˜“å¯¹åœ°å€
    )
    if err != nil {
        logx.Errorf("SendPairPriceChange2Kafka err:%v", err)
        return
    }
    logx.Infof("sendEventLogKafkaInfoMessage:%v:%v success", slot, pairAddress)
}
```

---

#### **6.4 åˆ†åŒºç­–ç•¥åˆ†æ**

**ä¸ºä»€ä¹ˆä½¿ç”¨ slot ä½œä¸º Keyï¼Ÿ**

1. **ä¸šåŠ¡éœ€æ±‚**ï¼š
   - Solana é“¾ä¸Šçš„äº¤æ˜“æŒ‰ slot ç»„ç»‡
   - åŒä¸€ä¸ª slot å†…çš„äº¤æ˜“éœ€è¦æœ‰åºå¤„ç†
   - ä¸åŒ slot ä¹‹é—´çš„äº¤æ˜“å¯ä»¥å¹¶è¡Œå¤„ç†

2. **åˆ†åŒºæ•ˆæœ**ï¼š
   ```
   Slot 310870231 â†’ Hash % 3 = 1 â†’ Partition 1
   Slot 310870232 â†’ Hash % 3 = 0 â†’ Partition 0
   Slot 310870233 â†’ Hash % 3 = 2 â†’ Partition 2
   Slot 310870234 â†’ Hash % 3 = 1 â†’ Partition 1  â† å¯èƒ½ä¸ 310870231 åœ¨åŒä¸€ Partition
   ```

3. **ä¼˜åŠ¿**ï¼š
   - âœ… **é¡ºåºä¿è¯**ï¼šç›¸åŒ slot çš„äº¤æ˜“æ€»æ˜¯è·¯ç”±åˆ°åŒä¸€ Partitionï¼Œä¿è¯é¡ºåº
   - âœ… **è´Ÿè½½å‡è¡¡**ï¼šslot ç¼–å·åˆ†å¸ƒç›¸å¯¹å‡åŒ€ï¼ŒPartition è´Ÿè½½å‡è¡¡
   - âœ… **å¯é¢„æµ‹æ€§**ï¼šç›¸åŒ slot æ€»æ˜¯è·¯ç”±åˆ°ç›¸åŒ Partition

---

#### **6.5 å®é™…è¿è¡Œç¤ºä¾‹**

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š

```
[kafka] send event log to kafka success: sol-trades:1:12345, 310870231, len(data): 1024
```

**æ—¥å¿—è§£æ**ï¼š
- `sol-trades`ï¼šTopic åç§°
- `1`ï¼šPartition IDï¼ˆæ¶ˆæ¯è¢«å‘é€åˆ° Partition 1ï¼‰
- `12345`ï¼šOffsetï¼ˆæ¶ˆæ¯åœ¨ Partition 1 ä¸­çš„åç§»é‡ï¼‰
- `310870231`ï¼šKeyï¼ˆslot ç¼–å·ï¼‰
- `len(data): 1024`ï¼šæ¶ˆæ¯å¤§å°ï¼ˆå­—èŠ‚ï¼‰

**åˆ†åŒºåˆ†å¸ƒç¤ºä¾‹**ï¼š

å‡è®¾å‘é€äº† 10 æ¡æ¶ˆæ¯ï¼Œslot ä» 310870230 åˆ° 310870239ï¼š

```
Slot 310870230 â†’ Partition 0 (hash % 3 = 0)
Slot 310870231 â†’ Partition 1 (hash % 3 = 1)
Slot 310870232 â†’ Partition 2 (hash % 3 = 2)
Slot 310870233 â†’ Partition 0 (hash % 3 = 0)
Slot 310870234 â†’ Partition 1 (hash % 3 = 1)
Slot 310870235 â†’ Partition 2 (hash % 3 = 2)
Slot 310870236 â†’ Partition 0 (hash % 3 = 0)
Slot 310870237 â†’ Partition 1 (hash % 3 = 1)
Slot 310870238 â†’ Partition 2 (hash % 3 = 2)
Slot 310870239 â†’ Partition 0 (hash % 3 = 0)
```

**ç»“æœ**ï¼š
- Partition 0ï¼š4 æ¡æ¶ˆæ¯
- Partition 1ï¼š3 æ¡æ¶ˆæ¯
- Partition 2ï¼š3 æ¡æ¶ˆæ¯
- è´Ÿè½½ç›¸å¯¹å‡è¡¡ âœ…

---

#### **6.6 é…ç½®è¯´æ˜**

**é…ç½®æ–‡ä»¶**ï¼š`apps/consumer/etc/consumer.yaml`

```yaml
KqSolTrades:
  Name: data-trade.rpc
  Brokers:
    - "172.19.0.14:9092"  # Kafka Broker åœ°å€
  Group: data-flow-default-group
  Topic: sol-trades       # Topic åç§°
  Offset: last
  Consumers: 3            # Consumer æ•°é‡
  Username: ckafka-user
  Password: your-password
```

**å…³é”®é…ç½®**ï¼š
- **Topic**ï¼š`sol-trades` - äº¤æ˜“æ•°æ® Topic
- **Consumers**ï¼š`3` - 3 ä¸ª Consumer å®ä¾‹ï¼Œå¯¹åº” 3 ä¸ª Partition
- **Brokers**ï¼šKafka Broker åœ°å€åˆ—è¡¨

---

#### **6.7 æ€»ç»“ï¼šé¡¹ç›®ä¸­çš„åˆ†åŒºå®è·µ**

| æ–¹é¢ | å®ç°æ–¹å¼ | è¯´æ˜ |
|------|---------|------|
| **åˆ†åŒºç­–ç•¥** | Hash åˆ†åŒº | `sarama.NewHashPartitioner` |
| **Key é€‰æ‹©** | Slot ç¼–å· | `fmt.Sprintf("%v", slot)` |
| **Topic** | `sol-trades` | Solana äº¤æ˜“æ•°æ® |
| **Partition æ•°é‡** | 3 | ä¸ Consumer æ•°é‡ä¸€è‡´ |
| **Producer ç±»å‹** | åŒæ­¥ Producer | ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸ |
| **é¡ºåºä¿è¯** | ç›¸åŒ slot â†’ ç›¸åŒ Partition | ä¿è¯ slot å†…äº¤æ˜“æœ‰åº |

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- âœ… **ä¸šåŠ¡åŒ¹é…**ï¼šä½¿ç”¨ slot ä½œä¸º Keyï¼Œç¬¦åˆ Solana é“¾çš„ä¸šåŠ¡ç‰¹ç‚¹
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šHash åˆ†åŒºå®ç°ç®€å•ï¼Œæ€§èƒ½å¥½
- âœ… **é¡ºåºä¿è¯**ï¼šç›¸åŒ slot çš„äº¤æ˜“æœ‰åºå¤„ç†
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šslot åˆ†å¸ƒå‡åŒ€ï¼ŒPartition è´Ÿè½½å‡è¡¡
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¢åŠ  Partition æ•°é‡æå‡ååé‡

---

### 7. æ€»ç»“

#### **åˆ†åŒºå«ä¹‰**

- **Partition** = Topic çš„ç‰©ç†åˆ†å‰²å•å…ƒ
- **1 ä¸ª Topic** = **N ä¸ª Partition**ï¼ˆN â‰¥ 1ï¼‰

#### **ä¸ºä»€ä¹ˆè¦åˆ†åŒºï¼Ÿ**

1. âš¡ **å¹¶è¡Œå¤„ç†**ï¼šæå‡ååé‡
2. ğŸ“ˆ **æ‰©å±•æ€§**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•
3. ğŸ”’ **éƒ¨åˆ†æœ‰åº**ï¼šä¿è¯å…³é”®æ¶ˆæ¯æœ‰åº
4. ğŸ›¡ï¸ **å®¹é”™æ€§**ï¼šæé«˜ç³»ç»Ÿå¯ç”¨æ€§

#### **æ€ä¹ˆåˆ†åŒºï¼Ÿ**

1. **Hash åˆ†åŒº**ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š`hash(key) % partitionCount`
2. **è½®è¯¢åˆ†åŒº**ï¼šå‡åŒ€åˆ†å¸ƒï¼Œæ— é¡ºåºä¿è¯
3. **è‡ªå®šä¹‰åˆ†åŒº**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰
4. **æŒ‡å®š Partition**ï¼šç›´æ¥æŒ‡å®šï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰

#### **å…³é”®è¦ç‚¹**

- âœ… **ç›¸åŒ Key â†’ ç›¸åŒ Partition**ï¼šä¿è¯é¡ºåº
- âœ… **Partition æ•°é‡**ï¼šæ ¹æ®ååé‡å’Œ Consumer æ•°é‡ç¡®å®š
- âœ… **ä»å°‘åˆ°å¤š**ï¼šåˆå§‹å°‘é‡ï¼Œé€æ­¥å¢åŠ 
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šç¡®ä¿ Partition è´Ÿè½½ç›¸å¯¹å‡è¡¡

---
